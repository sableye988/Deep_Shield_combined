{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <h2>워터마크 재검사</h2>
  <p>DeepShield로 보호된 PNG를 재검사해 추가적인 변형이 가해졌는지 확인합니다.</p>
</div>

<section class="detect-section">
  <div class="detect-container">

    <!-- 업로드 폼 -->
    <form method="POST" action="{{ url_for('verify') }}" enctype="multipart/form-data" class="detect-form">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <label for="image">PNG 업로드</label>
      <input type="file" id="image" name="image" accept="image/png" required>
      <p class="help">* 방지 페이지에서 받은 <strong>PNG</strong> 파일만 지원합니다.</p>
      <button type="submit">재검사 시작</button>
    </form>

    <!-- 결과 박스 -->
    <div class="detect-result-box">
      {% if result %}
        <h3>결과</h3>

        <div class="result-images">
          <img src="{{ result.uploaded_url }}" alt="업로드 이미지 미리보기">
        </div>

        <div class="result-metrics">
          {% if result.similarity is not none %}
            <p>
              유사도(Deepshild 워터마크 보존여부): 
              <strong>{{ result.similarity }}%</strong>
              <span class="tooltip">❓
                <span class="tooltip-text">
                  70% 이상: 정상 · 40~70%: 손상 · 40% 미만: 불일치
                </span>
              </span>
            </p>

            <div class="progress">
              <div class="bar" style="width: {{ result.similarity }}%;"></div>
            </div>
          {% else %}
            <p>유사도를 계산할 수 없습니다.</p>
          {% endif %}

          <p class="verdict">
            판정: <strong>{{ result.verdict }}</strong>
          </p>

          <details class="hint">
            <summary>판정 기준 보기</summary>
            <ul>
              <li><strong>70% 이상</strong>: 워터마크 정상 → 원본 가능성 높음</li>
              <li><strong>40% ~ 70%</strong>: 워터마크 손상 → 조작/딥페이크 의심</li>
              <li><strong>40% 미만</strong>: 워터마크 불일치 → 딥페이크 의심</li>
            </ul>
          </details>
        </div>
      {% else %}
        <p class="placeholder">여기에 재검사 결과가 표시됩니다.</p>
      {% endif %}
    </div>

  </div>
</section>

<style>
.progress{height:10px;background:#eee;border-radius:6px;overflow:hidden;margin:.5rem 0 1rem}
.progress .bar{height:100%}
</style>

{% endblock %}
